<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="fragments/head :: head(additionalCss='/css/index.css')"></head>
<body>
<header th:replace="fragments/navbar"></header>

<main>
    <section class="hero section">
        <div>

            <h1 class="hero-title"
                th:if="${#authentication != null and #authentication.name != 'anonymousUser'}"
                th:text="#{greeting.user(${#authentication.name})}">
            </h1>

            <h1 class="hero-title"
                th:unless="${#authentication != null and #authentication.name != 'anonymousUser'}"
                th:text="#{greeting}">
            </h1>

            <p th:text="#{slogan}">Find your next car with ease ‚Äî explore trusted offers, compare prices, and connect
                with verified
                sellers.</p>
            <a th:href="@{/offers/find}"
               class="cta-btn"
               th:text="#{button.browse}">Browse offers üöó</a>
        </div>
    </section>

    <div th:if="${flashMessage}" class="alert-toast alert-success">
        <span class="alert-icon">
            <img src="/images/car-travel-delete.svg" alt="icon">
        </span>
        <span th:text="${flashMessage}"></span>
    </div>

    <section class="quick-search section">
        <h2 th:text="#{quick.search}">Quick Search</h2>
        <p th:text="#{quick.search.desc}">Find the right car instantly ‚Äî filter by brand, price, or year.</p>

        <form th:action="@{/offers/quick-search}"
              th:object="${offersFindBindingModel}"
              method="post"
              class="search-form">

            <div class="quick-search-fields">

                <!-- Vehicle type -->
                <div class="form-group">
                    <label for="vehicleType" th:text="#{form.vehicleType}">Vehicle Type</label>
                    <select name="vehicleType"
                            id="vehicleType"
                            class="form-control">
                        <option value="" th:text="#{form.selectCategory}">- Select vehicle category -</option>
                        <option th:each="c : ${categories}"
                                th:value="${c.name().toLowerCase()}"
                                th:text="${c}">
                        </option>
                    </select>
                </div>

                <!-- Brand -->
                <div class="form-group">
                    <label for="brand" th:text="#{form.brand}">Brand</label>
                    <select th:field="*{brand}"
                            id="brand"
                            class="form-control">
                        <option value="" th:text="#{form.selectBrand}">- Select brand -</option>
                        <option th:each="b : ${brands}"
                                th:value="${b.name}"
                                th:text="${b.name}">
                        </option>
                    </select>
                    <div th:if="${#fields.hasErrors('brand')}"
                         th:errors="*{brand}"
                         class="error-msg"></div>
                </div>

                <!-- Model -->
                <div class="form-group">
                    <label for="model" th:text="#{form.model}">Model</label>
                    <select id="model"
                            class="form-control"
                            th:name="model"
                            th:errorclass="is-invalid"
                            th:selected="${model} == *{model}">
                        <option value="" selected th:text="#{form.selectModel}">- Select model -</option>
                        <optgroup label="Model name">
                            <option
                                    th:each="model : ${models}"
                                    th:text="${model}"
                                    th:value="${model}"
                                    th:selected="${model} == *{model}">
                            </option>
                        </optgroup>
                    </select>
                    <div th:if="${#fields.hasErrors('model')}"
                         th:errors="*{model}"
                         class="error-msg"></div>
                </div>

                <!-- Price -->
                <div class="form-group">
                    <label for="price" th:text="#{form.price}">Price</label>
                    <select th:field="*{priceComparison}" id="priceComparison" class="form-control">
                        <option value="under" th:text="#{form.price.under}">Under</option>
                        <option value="between" th:text="#{form.price.between}">Between</option>
                        <option value="above" th:text="#{form.price.above}">Above</option>
                    </select>
                    <input id="price" type="number" min="0" th:field="*{price}"
                           th:placeholder="#{form.price.placeholder}"
                           class="form-control"/>
                    <input id="priceMax" type="number" th:field="*{priceMax}" th:placeholder="#{form.price.max}"
                           style="display:none;" class="form-control"/>
                </div>

                <!-- Year -->
                <div class="form-group">
                    <label for="year" th:text="#{form.year}">Year</label>
                    <select th:field="*{yearComparison}"
                            id="yearComparison"
                            class="form-control">
                        <option value="under" th:text="#{form.year.before}">Before</option>
                        <option value="between" th:text="#{form.year.between}">Between</option>
                        <option value="above" th:text="#{form.year.after}">After</option>
                    </select>
                    <input id="year" type="number" step="1" th:field="*{year}" th:placeholder="#{form.year.placeholder}"
                           class="form-control"/>
                    <input id="yearMax" type="number" th:field="*{yearMax}" th:placeholder="#{form.year.max}"
                           style="display:none;"
                           class="form-control"/>
                </div>
            </div>

            <button th:text="#{button.search}" type="submit" id="searchBtn" class="cta-btn disabled-btn">Search</button>
        </form>
    </section>

    <section class="section">
        <h2 th:text="#{recent}" class="section-title">Recently added offers</h2>
        <div class="offers-grid">
            <th:block th:each="offer : ${latestOffers}">
                <div th:replace="fragments/offer-card :: offerCard(${offer}, true)"></div>
            </th:block>

            <div th:if="${#lists.isEmpty(latestOffers)}" class="no-offers">
                <p>No offers available</p>
            </div>
        </div>
        <div class="show-all">
            <a th:text="#{all.offers}" th:href="@{/offers/all}" class="cta-btn">All offers ‚Üí</a>
        </div>
    </section>

    <section class="section">
        <h2 th:text="#{offers.mostViewed}" class="section-title">Most viewed offers</h2>
        <div class="offers-grid">
            <th:block th:each="offer : ${mostViewedOffers}">
                <div th:replace="fragments/offer-card :: offerCard(${offer}, true)"></div>
            </th:block>

            <div th:if="${#lists.isEmpty(mostViewedOffers)}" class="no-offers">
                <p>No offers available</p>
            </div>
        </div>
        <div class="show-all">
            <a th:text="#{button.top20}" th:href="@{/offers/top-offers}" class="cta-btn">Show Top 20 ‚Üí</a>
        </div>
    </section>

    <section class="vehicle-grid section">
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('bmw','BMW','https://cdn.simpleicons.org/bmw/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('audi','Audi','https://cdn.simpleicons.org/audi/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('toyota','Toyota','https://cdn.simpleicons.org/toyota/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('mercedes','Mercedes','https://cdn.simpleicons.org/mercedes-benz/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('volkswagen','Volkswagen','https://cdn.simpleicons.org/volkswagen/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('dacia','Dacia','https://cdn.simpleicons.org/dacia/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('tesla','Tesla','https://cdn.simpleicons.org/tesla/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('honda','Honda','https://cdn.simpleicons.org/honda/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('ford','Ford','https://cdn.simpleicons.org/ford/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('nissan','Nissan','https://cdn.simpleicons.org/nissan/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('hyundai','Hyundai','https://cdn.simpleicons.org/hyundai/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('kia','Kia','https://cdn.simpleicons.org/kia/999999')"/>
    </section>

    <section class="why-choose-us section">
        <h2 class="section-title"
            th:utext="#{why.choose('<span class=&quot;brand-name&quot;>Mobilele</span>')}">
            Why choose <span class="brand-name">Mobilele</span>?
        </h2>
        <div class="features-grid">
            <div class="feature rating-feature ui-transition glass-effect">
                <i class="fa fa-star"></i>
                <h3 th:text="#{community.rating}">Our Community Rating</h3>

                <div class="rating-info ui-transition">
                    <div class="stars">
                        <i class="fa fa-star"
                           th:each="i : ${#numbers.sequence(1,5)}"
                           th:classappend="${i <= summary.rating} ? 'filled' : ''"></i>
                    </div>
                    <p class="rating-average">
                        <span th:text="${#numbers.formatDecimal(summary.rating, 1, 1)}">4.8</span> / 5
                    </p>
                    <p class="rating-count"
                       th:text="#{reviews.based(${summary.count})}">
                        Based on 124 reviews
                    </p>
                </div>
            </div>

            <div class="feature ui-transition glass-effect">
                <i class="fa fa-shield"></i>
                <h3 th:text="#{sellers.verified}">Verified Sellers</h3>
                <p th:text="#{sellers.verified.desc}">Every seller is verified for authenticity and trustworthiness.</p>
                <p class="feature-link">
                    <a th:text="#{btn.sellers.top}"
                       th:href="@{/sellers/top}"
                       class="text-link">
                        View our top sellers ‚Üí
                    </a>
                </p>
            </div>

            <div class="feature ui-transition glass-effect">
                <i class="fa fa-car"></i>
                <h3 th:text="#{selection.title}">Wide Selection</h3>
                <p th:text="#{selection.desc}">Thousands of offers from top brands and private owners.</p>
                <p th:text="#{selection.stats(${soldCount}, ${startYear})}">
                    Successfully sold 6 vehicles since 2025.
                </p>
            </div>

            <div class="feature ui-transition glass-effect">
                <i class="fa fa-clock-o"></i>
                <h3 th:text="#{fast.title}">Fast & Easy</h3>
                <p th:text="#{fast.desc}">Filter, compare, and contact sellers ‚Äî all in under a minute.</p>
            </div>

            <div class="feature ui-transition glass-effect">
                <i class="fa fa-money"></i>
                <h3 th:text="#{prices.title}">Transparent Prices</h3>
                <p th:text="#{prices.desc}">No hidden fees. See clear, real-time offers you can trust.</p>
            </div>
        </div>
    </section>

    <section class="reviews section">
        <h2 th:text="#{users.say}" class="section-title">What our users say ‚≠ê</h2>

        <div class="reviews-marquee">
            <div class="reviews-track">
                <div class="review-card glass-effect" th:each="feed : ${feedbacks}">
                    <div class="review-header">
                        <div class="review-info">
                            <span class="review-name"
                                  th:text="${feed.userFirstName + ' ' + feed.userLastName}">John Doe</span>
                            <span class="review-date"
                                  th:text="${#temporals.format(feed.created, 'dd MMM yyyy')}">10 Nov 2025</span>
                        </div>

                        <!-- Stars -->
                        <div class="review-stars">
                            <i class="fa fa-star"
                               th:each="i : ${#numbers.sequence(1,5)}"
                               th:classappend="${i <= feed.rating} ? 'filled' : ''"></i>
                        </div>
                    </div>

                    <p class="review-comment" th:text="${feed.comment}">
                        Great experience! Easy to find my dream car.
                    </p>
                </div>
            </div>
        </div>
    </section>
</main>

<footer th:replace="fragments/footer"></footer>
</body>

<script th:src="@{/js/loadModels.js}"></script>
<script th:src="@{/js/toggleSearchInputs.js}"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const toast = document.querySelector(".alert-toast");
        if (toast) {
            toast.classList.add("show");
            setTimeout(() => {
                toast.classList.remove("show");
            }, 4500); // 4.5s visible
        }
    });
</script>
</html>
