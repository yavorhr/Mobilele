<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="fragments/head :: head(additionalCss='/css/index.css')"></head>
<body>
<header th:replace="fragments/navbar"></header>

<main>
    <section class="hero section">
        <div>
            <h1 class="hero-title">
                Welcome to <span class="brand-name">Mobilele</span><span th:if="${#authentication != null and #authentication.name != 'anonymousUser'}">, <span class="welcome-message" th:text="${#authentication.name}"></span>
    </span>
            </h1>
            <p>Find your next car with ease ‚Äî explore trusted offers, compare prices, and connect with verified
                sellers.</p>
            <a th:href="@{/offers/find}" class="cta-btn">Find Your Offer Now üöó</a>
        </div>
    </section>

    <div th:if="${flashMessage}" class="alert-toast alert-success">
        <span class="alert-icon">
            <img src="/images/car-travel-delete.svg" alt="icon">
        </span>
        <span th:text="${flashMessage}"></span>
    </div>

    <section class="quick-search section">
        <h2>Quick Search</h2>
        <p>Find the right car instantly ‚Äî filter by brand, price, or year.</p>

        <form th:action="@{/offers/quick-search}"
              th:object="${offersFindBindingModel}"
              method="post"
              class="search-form">

            <div class="quick-search-fields">
                <!-- Vehicle type -->
                <div class="form-group">
                    <label for="vehicleType">Vehicle Type</label>
                    <select name="vehicleType"
                            id="vehicleType"
                            class="form-control">
                        <option value="">- Select vehicle category -</option>
                        <option th:each="c : ${categories}"
                                th:value="${c.name().toLowerCase()}"
                                th:text="${c}">
                        </option>
                    </select>
                </div>

                <!-- Brand -->
                <div class="form-group">
                    <label for="brand">Brand</label>
                    <select th:field="*{brand}"
                            id="brand"
                            class="form-control">
                        <option value="">- Select brand -</option>
                        <option th:each="b : ${brands}"
                                th:value="${b.name}"
                                th:text="${b.name}">
                        </option>
                    </select>
                    <div th:if="${#fields.hasErrors('brand')}"
                         th:errors="*{brand}"
                         class="error-msg"></div>
                </div>

                <!-- Model -->
                <div class="form-group">
                    <label for="model">Model</label>
                    <select id="model"
                            class="form-control"
                            th:name="model"
                            th:errorclass="is-invalid"
                            th:selected="${model} == *{model}">
                        <option value="" selected disabled>- Select model -</option>
                        <optgroup label="Model name">
                            <option
                                    th:each="model : ${models}"
                                    th:text="${model}"
                                    th:value="${model}"
                                    th:selected="${model} == *{model}">
                            </option>
                        </optgroup>
                    </select>
                    <p class="errors alert alert-danger invalid-feedback">
                        Vehicle model is required.
                    </p>
                </div>

                <!-- Price -->
                <div class="form-group">
                    <label for="price">Price</label>
                    <select th:field="*{priceComparison}" id="priceComparison" class="form-control">
                        <option value="under">Under</option>
                        <option value="between">Between</option>
                        <option value="above">Above</option>
                    </select>
                    <input id="price" type="number" min="0" th:field="*{price}" placeholder="Suggested price"
                           class="form-control"/>
                    <input id="priceMax" type="number" th:field="*{priceMax}" placeholder="Max price"
                           style="display:none;" class="form-control"/>
                </div>

                <!-- Year -->
                <div class="form-group">
                    <label for="year">Year</label>
                    <select th:field="*{yearComparison}"
                            id="yearComparison"
                            class="form-control">
                        <option value="under">Before</option>
                        <option value="between">Between</option>
                        <option value="above">After</option>
                    </select>
                    <input id="year" type="number" step="1" th:field="*{year}" placeholder="Manufacturing year"
                           class="form-control"/>
                    <input id="yearMax" type="number" th:field="*{yearMax}" placeholder="To year" style="display:none;"
                           class="form-control"/>
                </div>
            </div>

            <button type="submit" class="cta-btn">Search</button>
        </form>
    </section>

    <section class="section">
        <h2 class="section-title">Recent offers</h2>
        <div class="offers-grid">
            <th:block th:each="offer : ${latestOffers}">
                <div th:replace="fragments/offer-card :: offerCard(${offer}, true)"></div>
            </th:block>

            <div th:if="${#lists.isEmpty(latestOffers)}" class="no-offers">
                <p>No offers available</p>
            </div>
        </div>
        <div class="show-all">
            <a th:href="@{/offers/all}" class="cta-btn">Show All Offers ‚Üí</a>
        </div>
    </section>

    <section class="section">
        <h2 class="section-title">Most viewed offers</h2>
        <div class="offers-grid">
            <th:block th:each="offer : ${mostViewedOffers}">
                <div th:replace="fragments/offer-card :: offerCard(${offer}, true)"></div>
            </th:block>

            <div th:if="${#lists.isEmpty(mostViewedOffers)}" class="no-offers">
                <p>No offers available</p>
            </div>
        </div>
        <div class="show-all">
            <a th:href="@{/offers/top-offers}" class="cta-btn">Show top offers ‚Üí</a>
        </div>
    </section>

    <section class="vehicle-grid section">
    <th:block
                th:replace="fragments/brand-card :: vehicleCard('bmw','BMW','https://cdn.simpleicons.org/bmw/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('audi','Audi','https://cdn.simpleicons.org/audi/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('toyota','Toyota','https://cdn.simpleicons.org/toyota/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('mercedes','Mercedes','https://cdn.simpleicons.org/mercedes-benz/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('volkswagen','Volkswagen','https://cdn.simpleicons.org/volkswagen/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('dacia','Dacia','https://cdn.simpleicons.org/dacia/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('tesla','Tesla','https://cdn.simpleicons.org/tesla/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('honda','Honda','https://cdn.simpleicons.org/honda/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('ford','Ford','https://cdn.simpleicons.org/ford/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('nissan','Nissan','https://cdn.simpleicons.org/nissan/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('hyundai','Hyundai','https://cdn.simpleicons.org/hyundai/999999')"/>
        <th:block
                th:replace="fragments/brand-card :: vehicleCard('kia','Kia','https://cdn.simpleicons.org/kia/999999')"/>
    </section>

    <section class="why-choose-us section">
        <h2 class="section-title">Why to choose <span class="brand-name">Mobilele</span>?</h2>
        <div class="features-grid">
            <div class="feature rating-feature ui-transition glass-effect">
                <i class="fa fa-star"></i>
                <h3>Our Community Rating</h3>

                <div class="rating-info ui-transition">
                    <div class="stars">
                        <i class="fa fa-star"
                           th:each="i : ${#numbers.sequence(1,5)}"
                           th:classappend="${i <= summary.rating} ? 'filled' : ''"></i>
                    </div>
                    <p class="rating-average">
                        <span th:text="${#numbers.formatDecimal(summary.rating, 1, 1)}">4.8</span> / 5
                    </p>
                    <p class="rating-count">
                        Based on <span th:text="${summary.count}">124</span> reviews
                    </p>
                </div>
            </div>

            <div class="feature ui-transition glass-effect">
                <i class="fa fa-shield"></i>
                <h3>Verified Sellers</h3>
                <p>Every seller is verified for authenticity and trustworthiness.</p>
                <p class="feature-link">
                    <a th:href="@{/sellers/top}" class="text-link">
                        View our top sellers ‚Üí
                    </a>
                </p>
            </div>

            <div class="feature ui-transition glass-effect">
                <i class="fa fa-car"></i>
                <h3>Wide Selection</h3>
                <p>Thousands of offers from top brands and private owners. </p>
                <p>
                    Successfully sold
                    <span th:text="${soldCount}"></span>
                    vehicles since
                    <span th:text="${startYear}"></span>.
                </p>
            </div>

            <div class="feature ui-transition glass-effect">
                <i class="fa fa-clock-o"></i>
                <h3>Fast & Easy</h3>
                <p>Filter, compare, and contact sellers ‚Äî all in under a minute.</p>
            </div>

            <div class="feature ui-transition glass-effect">
                <i class="fa fa-money"></i>
                <h3>Transparent Prices</h3>
                <p>No hidden fees. See clear, real-time offers you can trust.</p>
            </div>
        </div>
    </section>

    <section class="reviews section">
        <h2 class="section-title">What our users say ‚≠ê</h2>

        <div class="reviews-marquee">
            <div class="reviews-track">
                <div class="review-card glass-effect" th:each="feed : ${feedbacks}">
                    <div class="review-header">
                        <div class="review-info">
                            <span class="review-name"
                                  th:text="${feed.userFirstName + ' ' + feed.userLastName}">John Doe</span>
                            <span class="review-date"
                                  th:text="${#temporals.format(feed.created, 'dd MMM yyyy')}">10 Nov 2025</span>
                        </div>

                        <!-- Stars -->
                        <div class="review-stars">
                            <i class="fa fa-star"
                               th:each="i : ${#numbers.sequence(1,5)}"
                               th:classappend="${i <= feed.rating} ? 'filled' : ''"></i>
                        </div>
                    </div>

                    <p class="review-comment" th:text="${feed.comment}">
                        Great experience! Easy to find my dream car.
                    </p>
                </div>
            </div>
        </div>
    </section>
</main>

<footer th:replace="fragments/footer"></footer>
</body>

<script th:src="@{/js/loadModels.js}"></script>
<script th:src="@{/js/toggleSearchInputs.js}"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const toast = document.querySelector(".alert-toast");
        if (toast) {
            toast.classList.add("show");
            setTimeout(() => {
                toast.classList.remove("show");
            }, 4500); // 4.5s visible
        }
    });
</script>
</html>
