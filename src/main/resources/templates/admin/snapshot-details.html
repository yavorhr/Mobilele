<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head(additionalCss='/css/admin/details.css')"></head>

<body>
<header th:replace="fragments/navbar"></header>

<main class="offer-container">

    <div class="container mt-4">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 style="color:#17a2b8;">Statistics Snapshot</h2>

            <a th:href="@{/admin/statistics}" class="btn btn-secondary btn-sm">Back</a>
        </div>

        <div class="stats-card">
            <h5>Snapshot Info</h5>
            <p>
                <strong>ID:</strong>
                <span th:text="${stats.id}"></span>
            </p>

            <p>
                <strong>Timestamp:</strong>
                <span th:text="${#temporals.format(stats.timeStamp, 'yyyy-MM-dd HH:mm:ss')}"></span>
            </p>

            <div class="row mt-3">

                <div class="col-md-4 mb-3">
                    <div class="stats-box">
                        <strong>Total Requests</strong>
                        <div th:text="${stats.totalRequests}"></div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="stats-box">
                        <strong>Anonymous</strong>
                        <div th:text="${stats.anonRequests}"></div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="stats-box">
                        <strong>Authenticated</strong>
                        <div th:text="${stats.authRequests}"></div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Endpoint Stats -->
        <div class="stats-card">
            <h5>Endpoint Statistics</h5>

            <div th:if="${#lists.isEmpty(stats.endpointStats)}">
                <p class="text-muted">No endpoint statistics available.</p>
            </div>

            <div th:if="${!#lists.isEmpty(stats.endpointStats)}" class="table-responsive">
                <table>
                    <thead>
                    <tr>
                        <th>Path</th>
                        <th class="text-end">Requests</th>
                        <th class="text-end">Avg (ms)</th>
                        <th class="text-end">4xx</th>
                        <th class="text-end">5xx</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="e : ${stats.endpointStats}">
                        <td th:text="${e.path}"></td>
                        <td class="text-end" th:text="${e.totalRequests}"></td>
                        <td class="text-end" th:text="${#numbers.formatDecimal(e.avgResponseTimeMs,1,2)}"></td>
                        <td class="text-end" th:text="${e.error4xx}"></td>
                        <td class="text-end" th:text="${e.error5xx}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- User Stats -->
        <div class="card mb-4 stats-card">
            <div class="card-body">

                <h5 class="card-title" style="color:#17a2b8; border-bottom:2px solid #17a2b8; padding-bottom:0.4rem;">
                    User Statistics
                </h5>

                <!-- User Stats -->
                <div>

                    <!-- No User Stats -->
                    <div th:if="${#lists.isEmpty(stats.userStats)}">
                        <p class="text-muted mb-0">No user data available.</p>
                    </div>

                    <!-- User Statistics Table -->
                    <div class="table-responsive" th:if="${!#lists.isEmpty(stats.userStats)}">
                        <table class="table table-striped table-sm mb-0">
                            <thead>
                            <tr>
                                <th>Username</th>
                                <th class="text-end">Requests</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="u : ${stats.userStats}">
                                <td th:text="${u.username}"></td>
                                <td class="text-end" th:text="${u.requests}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </div>

            </div>
        </div>
    </div>
</main>

<footer></footer>

</body>
</html>
