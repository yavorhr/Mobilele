<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head(additionalCss='/css/admin/details.css')"></head>

<body class="auth-layout">
<header th:replace="fragments/navbar"></header>

<main class="offer-container main-content">
    <div class="container mt-4">
        <div class="heading-wrapper d-flex align-items-center justify-content-center mb-4">
            <h2 class="section-title" th:text="#{stats.snapshot.title}">Snapshot Details</h2>
            <a th:href="@{/admin/statistics}" class="btn btn-secondary"
               th:text="#{stats.snapshot.back}">Back</a>
        </div>
        <section class="stats-card">
            <h5 class="card-title mb-3" th:text="#{stats.snapshot.info}">Snapshot Info</h5>

            <p><strong>ID:</strong> <span th:text="${stats.id}"></span></p>
            <p>
                <strong th:text="#{stats.snapshot.timestamp}">Timestamp:</strong>
                <span th:text="${#temporals.format(stats.timeStamp, 'yyyy-MM-dd HH:mm:ss')}"></span>
            </p>
            <div class="row mt-4">
                <div class="col-md-4 mb-3">
                    <div class="stats-box">
                        <strong th:text="#{stats.snapshot.totalRequests}">Total Requests</strong>
                        <div th:text="${stats.totalRequests}"></div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="stats-box">
                        <strong th:text="#{stats.snapshot.anonymous}">Anonymous</strong>
                        <div th:text="${stats.anonRequests}"></div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="stats-box">
                        <strong th:text="#{stats.snapshot.authenticated}">Authenticated</strong>
                        <div th:text="${stats.authRequests}"></div>
                    </div>
                </div>
            </div>
        </section>
        <section class="stats-card">
            <h5 class="card-title mb-3"
                th:text="#{stats.snapshot.visitedEndpoints}">Visited Endpoints</h5>

            <div th:if="${#lists.isEmpty(stats.endpointStats)}">
                <p class="text-muted mb-0" th:text="#{stats.snapshot.noEndpoints}">No endpoint statistics available.</p>
            </div>

            <div class="table-responsive" th:if="${!#lists.isEmpty(stats.endpointStats)}">
                <table class="table table-dark table-hover table-bordered align-middle mb-0">
                    <thead>
                    <tr>
                        <th th:text="#{stats.snapshot.path}">Path</th>
                        <th class="text-end" th:text=" #{stats.snapshot.requests}">Requests</th>
                        <th class="text-end" th:text="#{stats.snapshot.avg}">Avg (ms)</th>
                        <th class="text-end" th:text="#{stats.snapshot.error4xx}">4xx</th>
                        <th class="text-end" th:text="#{stats.snapshot.error5xx}">5xx</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="e : ${stats.endpointStats}">
                        <td th:text="${e.path}" th:title="${e.path}"></td>
                        <td class="text-end fw-semibold" th:text="${e.totalRequests}"></td>
                        <td class="text-end"
                            th:text="${#numbers.formatDecimal(e.avgResponseTimeMs,1,2)}"></td>
                        <td class="text-end text-warning" th:text="${e.error4xx}"></td>
                        <td class="text-end text-danger" th:text="${e.error5xx}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>
        <section class="stats-card mb-4">
            <h5 class="card-title mb-3" th:text="#{stats.snapshot.activeUsers}">Active Users</h5>

            <div th:if="${#lists.isEmpty(stats.userStats)}">
                <p class="text-muted mb-0" th:text="#{stats.snapshot.noUsers}">No user data available.</p>
            </div>

            <div class="table-responsive" th:if="${!#lists.isEmpty(stats.userStats)}">
                <table class="table table-dark table-striped table-hover table-bordered table-sm align-middle mb-0">
                    <thead>
                    <tr>
                        <th th:text="#{stats.snapshot.username}">Username</th>
                        <th class="text-end" th:text="#{stats.snapshot.requests}">Requests</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="u : ${stats.userStats}">
                        <td th:text="${u.username}"></td>
                        <td class="text-end fw-semibold" th:text="${u.requests}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</main>
<footer th:replace="fragments/minimal-footer"></footer>
</body>
</html>
