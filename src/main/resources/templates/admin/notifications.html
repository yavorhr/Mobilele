<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head(additionalCss='/css/admin/notifications.css')"></head>

<header th:replace="fragments/navbar"></header>

<body data-logged-in-username="${loggedInUsername}">
<div class="auth-layout">
    <main class="main-content">
        <section class="first-section">
            <h1 class="admin-header"
                th:text="#{admin.notifications.title}">Admin Notifications</h1>
        </section>

        <section class="second-section">
            <form
                    th:method="GET"
                    class="search-container"
                    action="/admin/notifications">
                <input type="text" id="searchInput"
                       name="query"
                       th:placeholder="#{admin.notifications.search.placeholder}"
                       th:value="${query}">
                <input type="hidden"
                       name="size"
                       th:value="${usersPage.size}">
                <button class="btn-submit" type="submit"
                        th:text="#{admin.notifications.search}">Search
                </button>
            </form>
            <div class="table-wrapper">
                <table class="notifications-table">
                    <thead>
                    <tr>
                        <th th:text="#{admin.notifications.status}">Status</th>
                        <th th:text="#{admin.notifications.lockedStatus}">Locked status</th>
                        <th th:text="#{admin.notifications.timesLocked}">Times Locked</th>
                        <th th:text="#{admin.notifications.username}">Username</th>
                        <th th:text="#{admin.notifications.email}">Email</th>
                        <th th:text="#{admin.notifications.created}">Created</th>
                        <th th:text="#{admin.notifications.roles}">Roles</th>
                        <th th:text="#{admin.notifications.actions}">Actions</th>
                    </tr>
                    </thead>
                    <tbody id="users-tbody">
                    <tr th:each="u :${users}" th:object="${u}">
                        <input type="hidden" name="user-id" class="user-id" th:value="*{id}">
                        <td class="status"
                            th:classappend="${u.isEnabled} ? 'active' : 'inactive'"
                            th:text="${u.isEnabled} ? #{admin.notifications.active} : #{admin.notifications.inactive}">
                        </td>
                        <td class="locked-status"
                            th:classappend="${u.accountLocked} ? 'inactive' : 'active'"
                            th:text="${u.accountLocked} ? #{admin.notifications.locked} : #{admin.notifications.notLocked}">
                        <td th:text="*{timesLocked}"></td>
                        <td class="username" th:text="*{username}">test2</td>
                        <td class="email" th:text="*{email}">test@abv.bg</td>
                        <td th:text="*{#temporals.format(registrationDate, 'yyyy-MM-dd HH:mm:ss')}">
                            formatted date
                        </td>
                        <td>
                            <div class="change-role-wrapper">
                                <div class="role-action-container">
                                    <th:block
                                            th:each="role : ${T(com.example.mobilele.model.entity.enums.UserRoleEnum).values()}">
                                        <div class="role-wrapper">
                                            <input type="checkbox" class="role-checkbox"
                                                   th:value="${role}"
                                                   th:checked="${u.roles.contains(role)}">
                                            <span th:text="${role}"></span>
                                        </div>
                                    </th:block>
                                </div>
                                <button class="change-role-btn btn btn-disabled"
                                        th:text="#{admin.notifications.updateRoles}">Update Roles
                                </button>
                            </div>
                        </td>
                        <td>
                            <div class="actions-container">
                                <button
                                        class="delete-btn btn"
                                        th:text="#{admin.notifications.deleteUser}">Delete User
                                </button>
                                <button
                                        class="enable-btn btn"
                                        th:text="${u.isEnabled} ? #{admin.notifications.disableUser} : #{admin.notifications.enableUser}"
                                        th:classappend="${u.isEnabled} ? 'inactive' : 'active'"> Enable/Disable User
                                </button>
                                <button
                                        class="lock-btn btn"
                                        th:text="${u.isAccountLocked} ? #{admin.notifications.unlockUser} : #{admin.notifications.lockUser}"
                                        th:classappend="${u.isAccountLocked} ? 'active' : 'inactive'"> Lock/Unlock User
                                </button>
                                <button class="send-email-btn btn"
                                        th:text="#{admin.notifications.sendEmail}">Send Email
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination-container d-flex justify-content-center align-items-center mt-4"
                 th:if="${totalPages > 1}">
                <!-- Prev -->
                <a th:if="${currentPage > 0}"
                   th:href="@{/admin/notifications(
           page=${currentPage - 1},
           query=${query},
           size=${usersPage.size})}"
                   class="pagination-btn"
                   th:text="#{pagination.prev}">
                    &laquo; Prev
                </a>

                <!-- Page numbers -->
                <div class="pagination-numbers mx-2">
                    <a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                       th:href="@{/admin/notifications(
               page=${i},
               query=${query},
               size=${usersPage.size})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number">
                    </a>
                </div>

                <!-- Next -->
                <a th:if="${currentPage + 1 < totalPages}"
                   th:href="@{/admin/notifications(
           page=${currentPage + 1},
           query=${query},
           size=${usersPage.size})}"
                   class="pagination-btn"
                   th:text="#{pagination.next}">
                    Next &raquo;
                </a>
            </div>

            <!-- Page indicator -->
            <p class="text-white text-center mt-2"
               th:if="${totalPages > 1}"
               th:text="#{pagination.pageInfo(${currentPage + 1}, ${totalPages})}">
            </p>

        </section>
    </main>

    <footer th:replace="fragments/minimal-footer"></footer>
</div>

</body>

<script src="/js/admin/notifications.js"></script>

<script th:inline="javascript">
    const loggedInUsername = /*[[${loggedInUsername}]]*/ "admin";
</script>

</html>
