<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head(additionalCss='/css/offers/offer-details.css')"></head>

<body class="auth-layout">
<header th:replace="fragments/navbar"></header>

<main class="main-content mt-">
    <div class="offer-page container mt-4"
         th:object="${offer}">

        <div class="main-section">
            <!-- === GALLERY SECTION === -->
            <section class="gallery-section section">
                <div class="main-image-container">
                    <div class="reserved-banner" th:if="*{isReserved}">
                        <span>Reserved</span>
                    </div>
                    <img id="modalImage"
                         th:src="*{pictures[0].pictureUrl}"
                         alt="Main Image"
                         class="main-image"
                         th:attr="data-public-id=*{pictures[0].picturePublicId}">

                    <button id="prevBtn" class="nav-btn left">&lt;</button>
                    <button id="nextBtn" class="nav-btn right">&gt;</button>

                    <th:block th:if="*{canModify}">
                        <button type="button"
                                id="deleteBtn"
                                data-offer-id="[[${offer.id}]]"
                                class="delete-image-btn"
                                title="Delete image">
                            <i class="fa fa-trash"></i>
                        </button>
                    </th:block>
                </div>

                <div class="thumbnail-container">
                    <img th:each="p, iterStat : *{pictures}"
                         th:src="${p.pictureUrl}"
                         th:attr="data-index=${iterStat.index}, data-public-id=${p.picturePublicId}"
                         class="thumbnail"
                         alt="Thumbnail">
                </div>
            </section>

            <!-- === INFO SECTION === -->
            <aside class="info-section section">
                <div class="views-favorites-wrapper">
                    <div class="views-counter">
                        <span class="eye-icon">üëÅÔ∏è</span>
                        <span th:text="'Views: ' + *{views}"></span>
                    </div>
                    <div class="favorite-container">
                        <div id="favorite-message" class="favorite-message"></div>
                        <th:block th:if="*{isNotOwnerOrIsAdmin}">
                            <button
                                    type="button"
                                    class="btn favorites-btn"
                                    th:data-offer-id="*{id}"
                                    th:classappend="${isFavorite} ? 'added' : ''">
                                <span class="heart-icon">üíñ</span>
                                <span class="btn-text"
                                      th:text="${isFavorite} ? 'Remove from Favorites' : 'Add to Favorites'"></span>
                            </button>
                        </th:block>
                    </div>
                </div>


                <h2 class="offer-title" th:text="*{modelBrandName} + ' ' + *{modelName}"></h2>
                <h4 th:text="'Year: ' + *{modelYear}"></h4>
                <p class="price" th:text="*{price} + ' BGN'"></p>

                <p class="location" th:text="*{country} + ', ' + *{city}"></p>

                <div class="seller-info">
                    <h4 class="section-heading">Seller Information</h4>
                    <p><i class="fa fa-user"></i> <span th:text="*{seller.getFullName()}"></span></p>
                    <p><i class="fa fa-envelope"></i> <span th:text="*{seller.getEmail()}"></span></p>
                    <p><i class="fa fa-phone"></i> <span th:text="*{seller.getPhoneNumber()}"></span></p>
                </div>


                <th:block th:if="*{canModify}">
                    <div class="modify-buttons">
                        <button
                                type="button"
                                class="btn reserve-btn"
                                th:data-offer-id="*{id}"
                                th:data-reserved="*{isReserved}"
                                th:classappend="${isReserved} ? 'reserved' : ''">
                            <span class="icon" th:text="${isReserved} ? 'üîí' : 'üü¢'"></span>
                            <span class="text"
                                  th:text="${isReserved} ? 'Cancel reservation' : 'Mark as reserved'"></span>
                        </button>

                        <a class="btn update-btn" th:href="@{/offers/update/{id}(id=${offer.id})}">Update</a>

                        <form
                                th:action="@{/offers/{id}(id=${offer.id})}"
                                th:method="delete"
                                id="delete-offer-form"
                                class="d-inline">
                            <input type="hidden" name="soldOffer" id="soldOffer" value="false"/>
                            <button type="button" id="delete-offer-btn" class="btn delete-btn">Delete</button>
                        </form>
                    </div>
                    <form id="picture-upload-form"
                          th:action="@{/pictures}"
                          th:method="POST"
                          enctype="multipart/form-data">

                        <input type="hidden" name="offerId" th:value="*{id}"/>
                        <input type="hidden" name="modelVehicleType" th:value="*{modelVehicleType}"/>

                        <div class="upload-container">
                            <input id="picture-upload"
                                   hidden
                                   type="file"
                                   name="pictures"
                                   multiple />

                            <label for="picture-upload"
                                   class="add-picture-btn"
                                   title="Add picture">
                                <i class="fa fa-plus"></i>
                                <span>Add pictures</span>
                            </label>

                            <div id="uploadSuccess" class="upload-message success">
                                Picture added
                            </div>

                            <div id="uploadFail" class="upload-message fail">
                                Picture can't be added
                            </div>
                        </div>
                    </form>
                </th:block>
            </aside>
        </div>

        <!-- === CAR DETAILS === -->
        <section class="car-details section">
            <h4 class="section-heading">Car Details</h4>
            <div class="details-grid">
                <div class="detail-item"><i class="fa fa-cogs"></i> <span th:text="*{engine}"></span></div>
                <div class="detail-item"><i class="fa fa-tachometer"></i> <span th:text="*{mileage} + ' km'"></span>
                </div>
                <div class="detail-item"><i class="fa fa-road"></i> <span th:text="*{transmission}"></span></div>
                <div class="detail-item"><i class="fa fa-paint-brush"></i> <span th:text="*{color}"></span></div>
                <div class="detail-item"><i class="fa fa-car"></i> <span th:text="*{condition}"></span></div>
                <div class="detail-item"><i class="fa fa-calendar"></i> <span th:text="*{modelYear}"></span></div>
            </div>
        </section>

        <!-- === DESCRIPTION === -->
        <section class="description-section section">
            <h4 class="section-heading" >Description</h4>
            <p th:text="*{description}"></p>
        </section>
    </div>

    <div id="delete-confirm-box" class="delete-confirm-overlay hidden">
        <div class="delete-confirm-window">
            <h4>Delete Offer</h4>
            <p>Did you manage to sell your car in Mobilele?</p>

            <div class="confirm-buttons">
                <button id="confirm-cancel" class="btn btn-secondary">Cancel</button>
                <button id="confirm-no" class="btn btn-warning">No, just delete</button>
                <button id="confirm-yes" class="btn btn-success">Yes, I sold it</button>
            </div>
        </div>
    </div>

</main>
<footer th:replace="fragments/minimal-footer"></footer>

</body>

<script src="/js/offer/gallery.js"></script>
<script src="/js/offer/uploadImage.js"></script>
<script src="/js/offer/deletePicture.js"></script>
<script src="/js/offer/add-to-favorites.js"></script>
<script src="/js/offer/reserve-offer.js"></script>
<script src="/js/offer/delete-offer-confirmation.js"></script>
</html>


