<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head(additionalCss='/css/offers/all-offers.css')"></head>

<body class="auth-layout">

<header th:replace="fragments/navbar"></header>

<main class="main-content">
    <div class="heading-wrapper"
         th:object="${filters}">
        <!-- Dynamic Heading -->
        <h2 th:if="${offers.size() > 0}"
            th:text="${context == 'model'} ?
        'All offers for ' + *{brand} + ' ' + *{model} :
        (${context == 'brand'} ?
            'All offers for : ' + ${brand} :
            (${context == 'favorites'} ?
                'Favorite offers' :
                'All offers'))"
            class="section-title text-center mt-5">
        </h2>

        <div th:unless="${offers.size() > 0}"
             class="no-offers-wrapper">
            <h3 class="no-offers-heading">
                Currently there are no offers available
            </h3>
            <p class="no-offers-subtext">
                Try adjusting your filters or check back later.
            </p>
        </div>
    </div>

    <!-- Sort Form -->
    <section class="d-flex justify-content-center mt-4 sort-container"
             th:if="${offers != null and offers.size() > 1}">
        <form th:action="${context == 'model'} ?
             @{/offers/{vehicleType}/{brand}/{modelName}(vehicleType=${vehicleType}, brand=${brand}, modelName=${model})} :
             (${context == 'brand'} ?
                @{/offers/brands/{brand}(brand=${brand})} :
                @{/my-offers})"
              method="GET"
              class="form-inline sort-form">
            <div class="sort-group">
                <label for="sort" class="text-white mr-2">Sort:</label>
                <select name="sort" id="sort" class="form-control mr-2">
                    <option value="price" th:selected="${sort == 'price'}">Price</option>
                    <option value="mileage" th:selected="${sort == 'mileage'}">Mileage</option>
                    <option value="creationDate" th:selected="${sort == 'creationDate'}">Creation Date</option>
                </select>

                <select name="dir" id="dir" class="form-control mr-2">
                    <option value="asc" th:selected="${dir == 'asc'}">Asc</option>
                    <option value="desc" th:selected="${dir == 'desc'}">Desc</option>
                </select>

                <button type="submit" class="sort-btn">Sort</button>
            </div>

        </form>
    </section>

    <!-- Offers List -->
    <div class="offers-grid mt-4">
        <th:block th:each="offer : ${offers}">
            <div th:replace="fragments/offer-card :: offerCard(${offer}, true)"></div>
        </th:block>
    </div>
    <div class="pagination-container d-flex justify-content-center align-items-center mt-4"
         th:if="${totalPages > 1}">

        <!-- Prev -->
        <th:block th:if="${currentPage > 0}">
            <th:block th:switch="${context}">
                <a th:case="'model'"
                   th:href="@{/offers/{vehicleType}/{brand}/{modelName}(
                   vehicleType=${vehicleType}, brand=${brand}, modelName=${model},
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>

                <a th:case="'brand'"
                   th:href="@{/offers/brands/{brand}(
                   brand=${brand},
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="btn">&laquo; Prev</a>

                <a th:case="'my'"
                   th:href="@{/offers/my-offers(
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>

                <a th:case="'favorites'"
                   th:href="@{/offers/favorites(
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>

                <!-- default → all -->
                <a th:case="*"
                   th:href="@{/offers/all(
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>
            </th:block>
        </th:block>

        <!-- Page Numbers -->
        <div class="pagination-numbers">
            <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <th:block th:switch="${context}">
                    <a th:case="'model'"
                       th:href="@{/offers/{vehicleType}/{brand}/{modelName}(
                     vehicleType=${vehicleType}, brand=${brand}, modelName=${model},
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>

                    <a th:case="'brand'"
                       th:href="@{/offers/brands/{brand}(
                     brand=${brand},
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>

                    <a th:case="'my'"
                       th:href="@{/offers/my-offers(
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>

                    <a th:case="'favorites'"
                       th:href="@{/offers/favorites(
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>

                    <!-- default → all -->
                    <a th:case="*"
                       th:href="@{/offers/all(
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>
                </th:block>
            </th:block>
        </div>

        <!-- Next -->
        <th:block th:if="${currentPage + 1 < totalPages}">
            <th:block th:switch="${context}">
                <a th:case="'model'"
                   th:href="@{/offers/{vehicleType}/{brand}/{modelName}(
                   vehicleType=${vehicleType}, brand=${brand}, modelName=${model},
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>

                <a th:case="'brand'"
                   th:href="@{/offers/brands/{brand}(
                   brand=${brand},
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>

                <a th:case="'my'"
                   th:href="@{/offers/my-offers(
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>

                <a th:case="'favorites'"
                   th:href="@{/offers/favorites(
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>

                <!-- default → all -->
                <a th:case="*"
                   th:href="@{/offers/all(
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>
            </th:block>
        </th:block>

        <!-- Page indicator -->
        <p class="text-white text-center mt-2"
           th:text="'Page ' + (${currentPage + 1}) + ' of ' + ${totalPages}"></p>
    </div>
</main>

<footer th:replace="fragments/minimal-footer"></footer>
</body>
</html>
