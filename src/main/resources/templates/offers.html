<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head(additionalCss='/css/offers/all-offers.css')"></head>

<body>

<header th:replace="fragments/navbar"></header>

<div class="container-fluid">

    <!-- Dynamic Heading -->
    <h2 th:if="${offers.size() > 0}"
        th:text="${context == 'model'} ?
              'All Offers for ' + brand + ' ' + model :
              ((context == 'brand') ?
                'All Offers for Brand: ' + brand :
                'My Offers')"
        class="text-center text-white mt-5">
    </h2>

    <h3 class="text-center text-white mt-5"
        th:unless="${offers.size() > 0}">
        Currently there are no offers available.
    </h3>

    <!-- Sort Form -->
    <div class="d-flex justify-content-center mt-4">
        <form th:action="${context == 'model'} ?
             @{/offers/{vehicleType}/{brand}/{modelName}(vehicleType=${vehicleType}, brand=${brand}, modelName=${model})} :
             (${context == 'brand'} ?
                @{/offers/brands/{brand}(brand=${brand})} :
                @{/my-offers})"
              method="GET"
              class="form-inline">

            <label for="sort" class="text-white mr-2">Sort by:</label>
            <select name="sort" id="sort" class="form-control mr-2">
                <option value="price" th:selected="${sort == 'price'}">Price</option>
                <option value="mileage" th:selected="${sort == 'mileage'}">Mileage</option>
                <option value="creationDate" th:selected="${sort == 'creationDate'}">Creation Date</option>
            </select>

            <select name="dir" id="dir" class="form-control mr-2">
                <option value="asc" th:selected="${dir == 'asc'}">Ascending</option>
                <option value="desc" th:selected="${dir == 'desc'}">Descending</option>
            </select>

            <button type="submit" class="btn btn-info">Sort</button>
        </form>
    </div>

    <!-- Offers List -->
    <div class="offers row mx-auto d-flex flex-row justify-content-center mt-4">
        <div th:each="o : ${offers}"
             th:object="${o}"
             class="offer card col-sm-6 col-md-3 col-lg-2 m-1 p-0">

            <div class="card-img-top-wrapper">
                <img class="card-img-top" th:src="*{profileImage}" alt="Car image">
            </div>

            <div class="card-body pb-1">
                <h5 class="card-title"
                    th:text="*{modelBrandName} + ' ' + *{modelName} + ' - ' + *{modelYear}">
                    Brand name Model name
                </h5>
            </div>

            <ul class="offer-details list-group list-group-flush">
                <li class="list-group-item">
                    <div class="card-text">
                        <span th:text="|Mileage: *{mileage} km|">Mileage</span>
                    </div>
                    <div class="card-text">
                        <span th:text="|Price: *{price} BGN|">Price</span>
                    </div>
                    <div class="card-text">
                        <span th:text="|Engine: *{engine}|">Engine</span>
                    </div>
                    <div class="card-text">
                        <span th:text="|Transmission: *{transmission}|">Transmission</span>
                    </div>
                    <div class="card-text">
                        <span th:text="|Created: *{#temporals.format(created, 'dd MMM yyyy')}|">Created</span>
                    </div>
                </li>
            </ul>

            <div class="card-body">
                <a class="card-link"
                   th:href="@{/offers/details/{id}(id=*{id})}">Details</a>
            </div>
        </div>
    </div>

    <div class="pagination-container d-flex justify-content-center align-items-center mt-4"
         th:if="${totalPages > 1}">

        <!-- Prev -->
        <th:block th:if="${currentPage > 0}">
            <th:block th:switch="${context}">
                <a th:case="'model'"
                   th:href="@{/offers/{vehicleType}/{brand}/{modelName}(
                   vehicleType=${vehicleType}, brand=${brand}, modelName=${model},
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>

                <a th:case="'brand'"
                   th:href="@{/offers/brands/{brand}(
                   brand=${brand},
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>

                <a th:case="'my'"
                   th:href="@{/offers/my-offers(
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>

                <a th:case="'favorites'"
                   th:href="@{/offers/favorites(
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>

                <!-- default → all -->
                <a th:case="*"
                   th:href="@{/offers/all(
                   page=${currentPage - 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">&laquo; Prev</a>
            </th:block>
        </th:block>

        <!-- Page Numbers -->
        <div class="pagination-numbers">
            <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <th:block th:switch="${context}">
                    <a th:case="'model'"
                       th:href="@{/offers/{vehicleType}/{brand}/{modelName}(
                     vehicleType=${vehicleType}, brand=${brand}, modelName=${model},
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>

                    <a th:case="'brand'"
                       th:href="@{/offers/brands/{brand}(
                     brand=${brand},
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>

                    <a th:case="'my'"
                       th:href="@{/offers/my-offers(
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>

                    <a th:case="'favorites'"
                       th:href="@{/offers/favorites(
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>

                    <!-- default → all -->
                    <a th:case="*"
                       th:href="@{/offers/all(
                     page=${i}, sort=${sort}, dir=${dir})}"
                       th:text="${i + 1}"
                       th:classappend="${i == currentPage} ? 'active' : ''"
                       class="pagination-number"></a>
                </th:block>
            </th:block>
        </div>

        <!-- Next -->
        <th:block th:if="${currentPage + 1 < totalPages}">
            <th:block th:switch="${context}">
                <a th:case="'model'"
                   th:href="@{/offers/{vehicleType}/{brand}/{modelName}(
                   vehicleType=${vehicleType}, brand=${brand}, modelName=${model},
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>

                <a th:case="'brand'"
                   th:href="@{/offers/brands/{brand}(
                   brand=${brand},
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>

                <a th:case="'my'"
                   th:href="@{/offers/my-offers(
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>

                <a th:case="'favorites'"
                   th:href="@{/offers/favorites(
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>

                <!-- default → all -->
                <a th:case="*"
                   th:href="@{/offers/all(
                   page=${currentPage + 1}, sort=${sort}, dir=${dir})}"
                   class="pagination-btn">Next &raquo;</a>
            </th:block>
        </th:block>

        <!-- Page indicator -->
        <p class="text-white text-center mt-2"
           th:text="'Page ' + (${currentPage + 1}) + ' of ' + ${totalPages}"></p>
    </div>

<footer></footer>
</body>
</html>
